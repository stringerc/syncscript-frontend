/**
 * SyncScript Mobile Responsiveness
 * BLOCKER #4: Ensure perfect experience on all devices
 * Tested on: iPhone SE (375px), iPhone 13 (390px), iPad (768px)
 */

/* ==========================================
   GLOBAL MOBILE FIXES
   ========================================== */

/* Prevent horizontal scroll */
html,
body {
  overflow-x: hidden;
  max-width: 100vw;
}

* {
  /* Prevent elements from causing horizontal scroll */
  max-width: 100%;
}

/* ==========================================
   MODAL FIXES - CRITICAL!
   ========================================== */

/* All modals should be scrollable on mobile */
@media (max-width: 768px) {
  [role="dialog"],
  .modal,
  .modal-content,
  .dialog {
    max-height: 90vh !important;
    max-height: 90dvh !important; /* Dynamic viewport height */
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    margin: var(--space-4) !important;
    width: calc(100vw - 32px) !important;
  }
  
  /* Modal container should be scrollable */
  .modal-overlay {
    padding: var(--space-4);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Modal body needs scroll */
  .modal-body {
    max-height: calc(90vh - 120px); /* Account for header/footer */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Don't let modal header/footer be too tall */
  .modal-header,
  .modal-footer {
    flex-shrink: 0;
  }
}

/* ==========================================
   HEADER RESPONSIVENESS
   ========================================== */

@media (max-width: 768px) {
  .dashboard-header,
  .compact-header {
    padding: var(--space-3) var(--space-4) !important;
  }
  
  .header-content,
  .compact-header-content {
    grid-template-columns: 1fr !important;
    gap: var(--space-3) !important;
  }
  
  /* Stack header sections vertically */
  .header-left,
  .header-center,
  .header-right {
    width: 100%;
  }
  
  /* Compact stats on mobile */
  .header-stats-compact,
  .compact-stats {
    flex-wrap: wrap;
    gap: var(--space-2) !important;
  }
  
  .stat-item {
    font-size: var(--text-sm) !important;
  }
  
  /* Hide less important stats on very small screens */
  @media (max-width: 375px) {
    .stat-item:nth-child(n+4) {
      display: none;
    }
  }
  
  /* Action buttons stack or hide on mobile */
  .header-actions {
    justify-content: center;
    flex-wrap: wrap;
  }
  
  /* Make primary CTA full-width on mobile */
  .btn-primary {
    width: 100%;
  }
}

/* ==========================================
   FLOATING ACTION BUTTON FIXES
   ========================================== */

@media (max-width: 768px) {
  .fab,
  .floating-action-button {
    /* Move above mobile bottom nav/safe area */
    bottom: 80px !important;
    right: var(--space-4) !important;
    
    /* Account for iOS safe area */
    bottom: calc(80px + env(safe-area-inset-bottom)) !important;
  }
  
  /* Smaller FAB on mobile */
  .fab-button {
    width: 56px !important;
    height: 56px !important;
  }
  
  /* FAB menu should not overlap content */
  .fab-menu {
    bottom: 72px;
    right: 0;
    max-height: 60vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
}

/* ==========================================
   TASK CARD RESPONSIVENESS
   ========================================== */

@media (max-width: 768px) {
  .task-card,
  .project-card {
    /* Prevent horizontal scroll */
    max-width: 100%;
    overflow-x: hidden;
    
    /* Stack elements vertically */
    flex-direction: column;
    gap: var(--space-3);
  }
  
  .task-card-content {
    width: 100%;
  }
  
  /* Smaller badges on mobile */
  .task-badge,
  .energy-badge,
  .priority-badge {
    font-size: var(--text-xs) !important;
    padding: 2px 6px !important;
  }
  
  /* Stack task actions vertically */
  .task-actions {
    flex-direction: column;
    width: 100%;
    gap: var(--space-2);
  }
  
  .task-actions button {
    width: 100%;
    justify-content: center;
  }
}

/* ==========================================
   TASK LIST GRID
   ========================================== */

@media (max-width: 1024px) {
  .tasks-grid {
    grid-template-columns: 1fr !important;
  }
}

@media (max-width: 768px) {
  .task-list {
    padding: var(--space-3) !important;
    gap: var(--space-3) !important;
  }
}

/* ==========================================
   SIDEBAR RESPONSIVENESS
   ========================================== */

@media (max-width: 1024px) {
  .dashboard-sidebar {
    /* Hide sidebar on tablets/mobile by default */
    position: fixed;
    left: -300px;
    top: 0;
    bottom: 0;
    width: 280px;
    z-index: var(--z-fixed);
    background: var(--color-neutral-0);
    box-shadow: var(--shadow-2xl);
    transition: left 300ms var(--ease-out);
  }
  
  .dashboard-sidebar.open {
    left: 0;
  }
  
  /* Backdrop for mobile sidebar */
  .sidebar-backdrop {
    display: block;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: calc(var(--z-fixed) - 1);
  }
  
  /* Main content takes full width */
  .dashboard-main {
    margin-left: 0 !important;
    width: 100% !important;
  }
}

/* ==========================================
   COMMAND CENTER MOBILE
   ========================================== */

@media (max-width: 768px) {
  .command-center,
  .unified-command-center {
    max-width: 100vw !important;
    max-height: 95vh !important;
    max-height: 95dvh !important;
    margin: var(--space-2) !important;
    border-radius: var(--radius-lg) !important;
  }
  
  .command-center-content {
    padding: var(--space-4) !important;
  }
  
  /* Grid becomes single column */
  .command-center-grid,
  .features-grid {
    grid-template-columns: 1fr !important;
    gap: var(--space-2) !important;
  }
  
  /* Search takes full width */
  .command-center-search {
    width: 100%;
  }
}

/* ==========================================
   FORM INPUTS MOBILE
   ========================================== */

@media (max-width: 768px) {
  input,
  textarea,
  select {
    font-size: 16px !important; /* Prevent iOS zoom */
    padding: var(--space-3) !important;
  }
  
  /* Full-width inputs on mobile */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="search"],
  textarea {
    width: 100%;
  }
}

/* ==========================================
   BUTTON RESPONSIVENESS
   ========================================== */

@media (max-width: 768px) {
  /* Ensure all buttons meet touch target size */
  button,
  .btn,
  [role="button"] {
    min-height: 44px;
    min-width: 44px;
    padding: var(--space-2) var(--space-4);
    font-size: var(--text-base);
  }
  
  /* Icon-only buttons */
  .btn-icon {
    width: 44px;
    height: 44px;
    padding: var(--space-2);
  }
  
  /* Button groups stack on mobile */
  .button-group {
    flex-direction: column;
    gap: var(--space-2);
  }
  
  .button-group button {
    width: 100%;
  }
}

/* ==========================================
   STATS & METRICS MOBILE
   ========================================== */

@media (max-width: 640px) {
  .user-stats,
  .stats-grid {
    grid-template-columns: 1fr !important;
    gap: var(--space-2) !important;
  }
  
  .stat-card {
    padding: var(--space-3) !important;
  }
  
  /* Smaller numbers on mobile */
  .stat-value {
    font-size: var(--text-2xl) !important;
  }
  
  .stat-label {
    font-size: var(--text-xs) !important;
  }
}

/* ==========================================
   KANBAN BOARD MOBILE
   ========================================== */

@media (max-width: 768px) {
  .kanban-board {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  
  .kanban-columns {
    flex-direction: row !important;
    min-width: fit-content;
  }
  
  .kanban-column {
    min-width: 280px;
    max-width: 280px;
  }
  
  /* Scroll hint */
  .kanban-board::after {
    content: "← Swipe to see more →";
    position: sticky;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--color-neutral-100);
    padding: var(--space-2);
    text-align: center;
    font-size: var(--text-xs);
    color: var(--color-neutral-600);
  }
}

/* ==========================================
   CALENDAR VIEW MOBILE
   ========================================== */

@media (max-width: 768px) {
  .calendar-view {
    padding: var(--space-2) !important;
  }
  
  .calendar-grid {
    font-size: var(--text-xs);
  }
  
  .calendar-day {
    min-height: 60px;
  }
  
  /* Month view only on mobile */
  .calendar-week-view,
  .calendar-day-view {
    display: none;
  }
}

/* ==========================================
   GANTT CHART MOBILE
   ========================================== */

@media (max-width: 768px) {
  .gantt-chart {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  
  .gantt-timeline {
    min-width: 800px; /* Allow horizontal scroll */
  }
}

/* ==========================================
   NAVIGATION MOBILE
   ========================================== */

@media (max-width: 768px) {
  /* Bottom navigation for mobile */
  .mobile-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--color-neutral-0);
    border-top: 1px solid var(--color-neutral-200);
    padding: var(--space-2);
    padding-bottom: calc(var(--space-2) + env(safe-area-inset-bottom));
    display: flex;
    justify-content: space-around;
    z-index: var(--z-sticky);
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
  }
  
  .mobile-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: var(--space-2);
    min-width: 64px;
    color: var(--color-neutral-600);
    text-decoration: none;
    font-size: 10px;
  }
  
  .mobile-nav-item.active {
    color: var(--color-primary-500);
  }
  
  .mobile-nav-icon {
    width: 24px;
    height: 24px;
  }
}

/* ==========================================
   VIEWPORT META TAG HELPER
   ========================================== */

/* Prevent text size adjustments on orientation change */
html {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* ==========================================
   SAFE AREA INSETS (iPhone notch/home indicator)
   ========================================== */

/* Add padding for iPhone safe areas */
@supports (padding: env(safe-area-inset-bottom)) {
  .safe-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .safe-top {
    padding-top: env(safe-area-inset-top);
  }
  
  .safe-left {
    padding-left: env(safe-area-inset-left);
  }
  
  .safe-right {
    padding-right: env(safe-area-inset-right);
  }
}

/* ==========================================
   ORIENTATION CHANGES
   ========================================== */

@media (orientation: landscape) and (max-height: 500px) {
  /* Landscape mode optimizations */
  .modal {
    max-height: 95vh !important;
  }
  
  .header {
    padding: var(--space-2) var(--space-4) !important;
  }
}

/* ==========================================
   UTILITY CLASSES
   ========================================== */

/* Hide on mobile */
@media (max-width: 768px) {
  .hide-mobile {
    display: none !important;
  }
}

/* Show only on mobile */
.show-mobile {
  display: none !important;
}

@media (max-width: 768px) {
  .show-mobile {
    display: block !important;
  }
  
  .show-mobile-flex {
    display: flex !important;
  }
}

/* ==========================================
   SPECIFIC COMPONENT FIXES
   ========================================== */

/* Dashboard Main Content */
@media (max-width: 1024px) {
  .dashboard-main {
    padding: var(--space-4) var(--space-3) !important;
    margin-bottom: 80px; /* Account for mobile nav */
  }
}

@media (max-width: 640px) {
  .dashboard-main {
    padding: var(--space-3) var(--space-2) !important;
  }
}

/* Progress bars */
@media (max-width: 768px) {
  .progress-bar {
    min-width: 100px; /* Ensure readable on mobile */
  }
  
  .level-progress-card {
    width: 100%;
  }
}

/* Quick Switcher */
@media (max-width: 768px) {
  .quick-switcher {
    width: calc(100vw - 32px) !important;
    max-height: 80vh !important;
    margin: var(--space-4) !important;
  }
  
  .quick-switcher-results {
    max-height: 60vh;
  }
}

/* Analytics Dashboard */
@media (max-width: 768px) {
  .analytics-grid {
    grid-template-columns: 1fr !important;
  }
  
  .chart-container {
    width: 100% !important;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}

/* Team Dashboard */
@media (max-width: 768px) {
  .team-members-grid {
    grid-template-columns: 1fr !important;
  }
  
  .team-chat {
    height: calc(100vh - 200px) !important;
  }
}

/* Energy Selector */
@media (max-width: 640px) {
  .energy-selector {
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .energy-button {
    width: 44px !important;
    height: 44px !important;
  }
}

/* Achievement Gallery */
@media (max-width: 768px) {
  .achievements-grid {
    grid-template-columns: repeat(2, 1fr) !important;
  }
}

@media (max-width: 480px) {
  .achievements-grid {
    grid-template-columns: 1fr !important;
  }
}

/* Template Library */
@media (max-width: 768px) {
  .template-grid {
    grid-template-columns: 1fr !important;
  }
}

/* Filters */
@media (max-width: 768px) {
  .filter-bar {
    flex-wrap: wrap;
    gap: var(--space-2);
  }
  
  .filter-button {
    flex: 1 1 45%;
    min-width: 120px;
  }
}

/* Search bars */
@media (max-width: 768px) {
  .search-bar,
  .task-search {
    width: 100% !important;
  }
}

/* ==========================================
   TABLES (Mobile)
   ========================================== */

@media (max-width: 768px) {
  /* Convert tables to cards on mobile */
  table.responsive {
    display: block;
  }
  
  table.responsive thead {
    display: none;
  }
  
  table.responsive tbody,
  table.responsive tr,
  table.responsive td {
    display: block;
    width: 100%;
  }
  
  table.responsive tr {
    margin-bottom: var(--space-4);
    border: 1px solid var(--color-neutral-200);
    border-radius: var(--radius-lg);
    padding: var(--space-3);
  }
  
  table.responsive td::before {
    content: attr(data-label);
    font-weight: var(--font-semibold);
    display: block;
    margin-bottom: var(--space-1);
    color: var(--color-neutral-600);
  }
}

/* ==========================================
   TEXT SIZING
   ========================================== */

/* Responsive typography */
@media (max-width: 768px) {
  h1 { font-size: var(--text-2xl) !important; }
  h2 { font-size: var(--text-xl) !important; }
  h3 { font-size: var(--text-lg) !important; }
  h4 { font-size: var(--text-base) !important; }
  
  .dashboard-title {
    font-size: var(--text-2xl) !important;
  }
  
  .dashboard-subtitle {
    font-size: var(--text-sm) !important;
  }
}

/* ==========================================
   SPACING ADJUSTMENTS
   ========================================== */

@media (max-width: 768px) {
  /* Reduce spacing on mobile */
  .gap-large { gap: var(--space-3) !important; }
  .gap-medium { gap: var(--space-2) !important; }
  
  /* Smaller padding */
  .padding-large { padding: var(--space-4) !important; }
  .padding-medium { padding: var(--space-3) !important; }
}

/* ==========================================
   LANDSCAPE MOBILE
   ========================================== */

@media (max-width: 896px) and (orientation: landscape) {
  .dashboard-header {
    padding: var(--space-2) var(--space-4) !important;
  }
  
  .modal {
    max-height: 90vh !important;
  }
}

/* ==========================================
   VERY SMALL SCREENS (iPhone SE)
   ========================================== */

@media (max-width: 375px) {
  /* Extra compact for iPhone SE */
  .dashboard-main {
    padding: var(--space-2) !important;
  }
  
  .task-card {
    padding: var(--space-3) !important;
  }
  
  /* Stack everything */
  .flex-row-mobile {
    flex-direction: column !important;
  }
  
  /* Smaller fonts */
  .responsive-text {
    font-size: var(--text-sm) !important;
  }
}

/* ==========================================
   PRINT STYLES
   ========================================== */

@media print {
  /* Hide UI elements when printing */
  .fab,
  .floating-action-button,
  .mobile-nav,
  .sidebar,
  .header-actions,
  button {
    display: none !important;
  }
  
  /* Expand content */
  .dashboard-main {
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
  }
  
  /* Show all tasks */
  .task-card {
    page-break-inside: avoid;
  }
}

